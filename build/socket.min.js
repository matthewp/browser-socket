(function(){function t(){if(!t.BROWSER)throw"This browser doesn't support TCP sockets."}if(navigator.mozTCPSocket){var t=function(){navigator.mozTCPSocket.apply(this,arguments)};t.prototype=Object.create(navigator.mozTCPSocket.prototype),t.BROWSER="mozilla"}(function(){var o=function(){};chrome&&chrome.socket&&(t.BROWSER="chrome",t.prototype.open=function(t,o){var e=arguments;this._socketId||chrome.socket.create("tcp",{onEvent:this._onDataReceived.bind(this)},function(t){this._socketId=t.socketId,this.open.apply(this,e)}.bind(this)),chrome.socket.connect(this._socketId,t,o,function(){this.onopen()}.bind(this))},t.protoype.send=function(t){var o=this._asArrayBuffer(t);chrome.socket.write(this._socketId,o,function(){this.ondrain()}.bind(this))},t.prototype.suspend=function(){},t.prototype.resume=function(){},t.prototype.close=function(){chrome.socket.destroy(this._socketId)},t.prototype.onopen=o,t.prototype.ondrain=o,t.prototype.ondata=o,t.prototype.onerror=o,t.prototype.onclose=o,t.prototype._onDataReceived=function(t){var o=chrome.socket.read(t.socketId);this.ondata(o)},t.prototype._asArrayBuffer=function(t){if(t instanceof ArrayBuffer)return t;for(var o=""+t,e=new ArrayBuffer(2*o.length),n=new Uint16Array(e),r=0,c=o.length;c>r;r++)n[r]=o.charCodeAt(r);return e})})()})();